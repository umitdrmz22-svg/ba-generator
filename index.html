
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Betriebsanweisung – Auswahl</title>

  <!-- CSS'i DOĞRU şekilde bağla -->
  <link rel="stylesheet" href="/assets/style.css" />

  <!-- Tür bazlı tema -->
  <style>
    :root { --theme-color: #005aa3; }
    .t-Gefahrstoff { --theme-color: #E53935; }
    .t-Biostoff    { --theme-color: #2E7D32; }
    .t-Maschine    { --theme-color: #005AA3; }
    .t-PSA         { --theme-color: #6A1B9A; }
    .hero { background: linear-gradient(120deg, var(--theme-color), #111); color:#fff;
            border-radius:10px; padding:16px 18px; margin-bottom:14px; box-shadow:0 8px 24px rgba(0,0,0,.12); }
    .hero h1 { margin:0; font-size:20px; }
  </style>
</head>
<body class="page">
<div class="wrapper t-Gefahrstoff" id="indexRoot">

  <div class="hero"><h1>Betriebsanweisung – Auswahl</h1></div>

  <section class="box">
    <label>Typ wählen:</label>
    <div class="row" id="typeRow">
      <label><input type="radio" name="type" value="Gefahrstoff"> Gefahrstoff</label>
      <label><input type="radio" name="type" value="Biostoff"> Biostoff</label>
      <label><input type="radio" name="type" value="Maschine"> Maschine</label>
      <label><input type="radio" name="type" value="PSA"> PSA</label>
    </div>
  </section>

  <section class="box">
    <div class="grid2">
      <div>
        <label>Unternehmen</label><input id="firm" type="text" placeholder="Firmenname">
        <label>Abteilung</label><input id="dept" type="text" placeholder="Abteilung">
        <label>Ersteller</label><input id="author" type="text" placeholder="Name">
        <label>Datum</label><input id="date" type="date">
      </div>
      <div>
        <label>Logo hochladen</label>
        <input id="logoFile" type="file" accept="image/*">
        <small>PNG/JPG önerilir. Logo Supabase Storage → <b>logos</b> bucket’ına yüklenir.</small>
        <div id="logoPreview" class="logo-preview"></div>
      </div>
    </div>
  </section>

  <div class="actions">
    <button id="continue" class="btn-primary">Weiter zur Vorlage</button>
  </div>
</div>

<!-- JS'i DOĞRU şekilde (ESM) bağla -->
<script type="module" src="/assets/app.js"></script>

<!-- Yedek: app.js çalışmasa bile buton çalışsın (fallback) -->
<script>
  (function () {
    const btn = document.getElementById('continue');
    if (!btn) return;
    btn.addEventListener('click', (e) => {
      // app.js zaten handle ediyorsa bubble etsin; fallback tetiklenirse çalışır
      if (btn.dataset.bound === '1') return;

      e.preventDefault();
      const type = [...document.querySelectorAll('input[name="type"]')].find(r => r.checked)?.value;
      const firm = document.getElementById('firm')?.value?.trim();
      const dept = document.getElementById('dept')?.value?.trim();
      const author = document.getElementById('author')?.value?.trim();
      const date = document.getElementById('date')?.value;

      if (!type || !firm || !author || !date) {
        alert('Bitte Typ, Unternehmen, Ersteller und Datum ausfüllen.');
        return;
      }
      const head = { type, firm, dept: dept || '', author, date, logoUrl: window.__uploadedLogoUrl || '' };
      try { localStorage.setItem('BA_HEAD', JSON.stringify(head)); } catch {}
      // relatif yol, kökte de çalışır
      location.href = 'editor.html';
    });
  })();

  // Tür seçimi → tema sınıfı
  (function () {
    const indexRoot = document.getElementById('indexRoot');
    const typeRow = document.getElementById('typeRow');
    typeRow?.addEventListener('change', (e) => {
      const val = e.target?.value;
      if (!val) return;
      indexRoot.classList.remove('t-Gefahrstoff','t-Biostoff','t-Maschine','t-PSA');
      indexRoot.classList.add('t-' + val);
    });
  })();
</script>
</body>
</html>
